<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>تسجيل المحل</title>
   <link rel="stylesheet" href="tt.css">
</head>
<body>

<h2>📋 نموذج تسجيل المحل</h2>

<form onsubmit="event.preventDefault(); sendToWhatsApp();">
  <label>🌟 اسم المحل:</label>
  <input type="text" id="store-name" required>

  <label>📞 رقم الهاتف:</label>
  <input type="text" id="contact-number" required>

  <label>🛠️ نوع الطلب:</label>
  <select id="mode" onchange="toggleSections()" required>
    <option value="">-- اختر --</option>
    <option value="register">تسجيل</option>
    <option value="promote">ترويج فقط</option>
  </select>

  <label>📍 المحافظة:</label>
  <select id="province" onchange="onProvinceChange()" required>
    <option value="">-- اختر المحافظة --</option>
    <option value="بغداد">بغداد</option>
    <option value="البصرة">البصرة</option>
    <option value="نينوى">نينوى</option>
    <option value="النجف">النجف</option>
    <option value="ذي قار">ذي قار</option>
    <option value="اربيل">أربيل</option>
    <option value="الانبار">الأنبار</option>
    <option value="كركوك">كركوك</option>
    <option value="السليمانية">السليمانية</option>
    <option value="دهوك">دهوك</option>
    <option value="بابل">بابل</option>
    <option value="كربلاء">كربلاء</option>
    <option value="واسط">واسط</option>
    <option value="صلاح الدين">صلاح الدين</option>
    <option value="ميسان">ميسان</option>
    <option value="المثنى">المثنى</option>
    <option value="القادسية">القادسية</option>
  </select>

  <div id="baghdad-options" style="display:none;">
    <label>⬅️ الجهة:</label>
    <select id="baghdad-side" onchange="loadBaghdadAreas()">
      <option value="">-- اختر --</option>
      <option value="رصافة">رصافة</option>
      <option value="كرخ">كرخ</option>
    </select>

    <label>📌 المنطقة:</label>
    <select id="baghdad-area" onchange="checkBaghdadArea()">
      <option value="">-- اختر --</option>
    </select>
  </div>

  <label>📌 العنوان التفصيلي:</label>
  <textarea id="address" required></textarea>

  <div id="register-section" style="display:none;">
    <label>💼 اختر الباقة:</label>
    <select id="package">
      <option value="">-- اختر الباقة --</option>
      <option value="100">باقة 100$ (كول سنتر + مندوبين + توصيل)</option>
      <option value="150" style="display:none;">باقة 150$ (كل ما سبق + تصوير وتصميم)</option>
    </select>

    <label>📢 هل تحتاج ترويج؟</label>
    <select id="promotion-needed" onchange="togglePromoPrice()">
      <option value="">-- اختر --</option>
      <option value="نعم">نعم</option>
      <option value="لا">لا</option>
    </select>

    <div id="promo-price-section" style="display:none;">
      <label>💰 سعر المنتج للترويج ($):</label>
      <input type="number" id="product-price">
    </div>
  </div>

  <div id="promote-section" style="display:none;">
    <label>💰 سعر المنتج للترويج ($):</label>
    <input type="number" id="only-promo-price">
  </div>

  <button type="submit">📤 إرسال عبر واتساب</button>
  <button type="button" onclick="sendLocation()">📍 إرسال موقعي</button>
  <button class="button111" onclick="window.location.href='index.html'">رجوع الى صفحة الاساسية</button>
</form>

<script>
  function toggleSections() {
    const mode = document.getElementById("mode").value;
    document.getElementById("register-section").style.display = mode === "register" ? "block" : "none";
    document.getElementById("promote-section").style.display = mode === "promote" ? "block" : "none";
  }

  function togglePromoPrice() {
    const show = document.getElementById("promotion-needed").value === "نعم";
    document.getElementById("promo-price-section").style.display = show ? "block" : "none";
  }

  function onProvinceChange() {
    const province = document.getElementById("province").value;
    document.getElementById("baghdad-options").style.display = province === "بغداد" ? "block" : "none";
    checkBaghdadArea();
  }

  function loadBaghdadAreas() {
    const side = document.getElementById("baghdad-side").value;
    const areaSelect = document.getElementById("baghdad-area");
    areaSelect.innerHTML = '<option value="">-- اختر --</option>';

    const areas = side === "رصافة" ? ["رصافة أولى", "رصافة ثانية", "رصافة ثالثة"] :
                 side === "كرخ" ? ["كرخ أولى", "كرخ ثانية", "كرخ ثالثة"] : [];

    areas.forEach(area => {
      const opt = document.createElement("option");
      opt.value = area;
      opt.textContent = area;
      areaSelect.appendChild(opt);
    });

    checkBaghdadArea();
  }

  function checkBaghdadArea() {
    const province = document.getElementById("province").value;
    const side = document.getElementById("baghdad-side").value;
    const area = document.getElementById("baghdad-area").value;
    const pkg150 = document.querySelector('#package option[value="150"]');

    if (province === "بغداد" && side === "رصافة" && area === "رصافة ثالثة") {
      pkg150.style.display = "block";
    } else {
      pkg150.style.display = "none";
    }
  }

  async function getUserIP() {
    try {
      const res = await fetch("https://api.ipify.org?format=json");
      const data = await res.json();
      return data.ip;
    } catch {
      return "غير معروف";
    }
  }

  async function sendToWhatsApp() {
    const name = document.getElementById("store-name").value.trim();
    const phone = document.getElementById("contact-number").value.trim();
    const mode = document.getElementById("mode").value;
    const province = document.getElementById("province").value;
    const side = document.getElementById("baghdad-side").value;
    const area = document.getElementById("baghdad-area").value;
    const address = document.getElementById("address").value.trim();

    if (!name || !phone || !province || !address) {
      alert("يرجى تعبئة كل الحقول");
      return;
    }

    let message = `🔥 طلب جديد:\n\n📌 الاسم: ${name}\n📞 الهاتف: ${phone}\n🏘️ المحافظة: ${province}`;
    if (province === "بغداد") {
      message += `\n⬅️ الجهة: ${side}\n📍 المنطقة: ${area}`;
    }
    message += `\n📌 العنوان: ${address}`;

    let total = 0;

    if (mode === "register") {
      const pkg = document.getElementById("package").value;
      const promo = document.getElementById("promotion-needed").value;
      message += `\n\n💼 باقة التسجيل: ${pkg}$`;
      total += parseFloat(pkg);

      if (promo === "نعم") {
        const price = parseFloat(document.getElementById("product-price").value || 0);
        const cost = Math.ceil((price / 5) * 2);
        message += `\n📢 ترويج؟ نعم\n💰 سعر المنتج: ${price}$\n📢 كلفة الترويج: ${cost}$`;
        total += cost;
      } else {
        message += `\n📢 ترويج؟ لا`;
      }

    } else if (mode === "promote") {
      const price = parseFloat(document.getElementById("only-promo-price").value || 0);
      const cost = Math.ceil((price / 5) * 2);
      total += cost;
      message += `\n\n📢 ترويج فقط\n💰 سعر المنتج: ${price}$\n📢 كلفة الترويج: ${cost}$`;
    }

    const ip = await getUserIP();
    message += `\n\n🌍 IP: ${ip}\n💵 المجموع الكلي: ${total}$`;

    const finalUrl = `https://wa.me/9647727220385?text=${encodeURIComponent(message)}`;
    window.open(finalUrl, "_blank");
  }

  function sendLocation() {
    const url = `https://wa.me/9647727220385?text=📍 هذا موقعي: ${encodeURIComponent(window.location.href)}`;
    window.open(url, "_blank");
  }
</script>

</body>
</html>
